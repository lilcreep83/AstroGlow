<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stargazing Conditions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#1A202C',
                        'secondary': '#4A5568',
                        'accent': '#63B3ED',
                        'night-sky': '#0B132B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .star {
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.8));
        }
        .loading-dot {
            animation: pulse 1.5s infinite ease-in-out;
        }
        .loading-dot:nth-child(2) { animation-delay: 0.3s; }
        .loading-dot:nth-child(3) { animation-delay: 0.6s; }
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-night-sky min-h-screen p-4 flex items-start justify-center font-sans text-white">

    <div id="app" class="w-full max-w-sm p-6 bg-primary rounded-xl shadow-2xl space-y-6 mt-10">
        <h1 class="text-3xl font-bold text-center text-accent">Night Sky Forecast</h1>
        <p class="text-sm text-center text-gray-400">
            This app uses your location to provide a simulated stargazing rating.
            Accurate data requires an external astronomy API.
        </p>

        <div id="status-card" class="p-4 rounded-lg bg-secondary text-center space-y-2">
            <!-- Loader State -->
            <div id="loader" class="flex justify-center items-center space-x-2">
                <div class="loading-dot w-3 h-3 bg-accent rounded-full"></div>
                <div class="loading-dot w-3 h-3 bg-accent rounded-full"></div>
                <div class="loading-dot w-3 h-3 bg-accent rounded-full"></div>
                <span class="text-lg">Locating User...</span>
            </div>
            <!-- Error State - This content will be overwritten by handleError() -->
            <div id="error-message" class="hidden text-left text-red-300">
                <!-- Detailed error message injected here -->
            </div>
        </div>

        <div id="results-card" class="hidden space-y-4">
            <!-- Location Details -->
            <div class="p-4 bg-secondary rounded-lg">
                <h2 class="text-lg font-semibold mb-2 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-accent" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                    </svg>
                    Your Coordinates
                </h2>
                <p class="text-sm text-gray-300">Lat: <span id="lat-display" class="font-mono"></span></p>
                <p class="text-sm text-gray-300">Lon: <span id="lon-display" class="font-mono"></span></p>
            </div>

            <!-- Stargazing Rating -->
            <div class="p-4 bg-secondary rounded-lg text-center">
                <h2 class="text-xl font-bold mb-2">Stargazing Rating</h2>
                <div id="rating-stars" class="flex justify-center text-3xl mb-2" aria-live="polite">
                    <!-- Stars will be injected here -->
                </div>
                <p id="condition-text" class="text-accent text-xl font-bold"></p>
                <p id="advice-text" class="text-sm text-gray-400 mt-1"></p>
            </div>
        </div>

        <button onclick="getLocation()" class="w-full py-3 bg-accent hover:bg-blue-300 transition-colors text-primary font-bold rounded-lg shadow-lg">
            Recheck Conditions
        </button>
    </div>

    <script>
        const latDisplay = document.getElementById('lat-display');
        const lonDisplay = document.getElementById('lon-display');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');
        const resultsCard = document.getElementById('results-card');
        const ratingStars = document.getElementById('rating-stars');
        const conditionText = document.getElementById('condition-text');
        const adviceText = document.getElementById('advice-text');

        // --- Utility Functions ---

        /**
         * Converts a numerical rating (0-5) into star icons and color.
         * @param {number} rating - The calculated condition rating.
         */
        function displayRating(rating) {
            const fullStar = '<span class="star text-yellow-300">â˜…</span>';
            const emptyStar = '<span class="star text-gray-600">â˜…</span>';

            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += (i <= rating) ? fullStar : emptyStar;
            }
            ratingStars.innerHTML = starsHtml;

            // Determine text and advice based on rating
            let condition = '';
            let advice = '';

            if (rating >= 4) {
                condition = 'Excellent Conditions';
                advice = 'Grab your gear! Perfect darkness and clear skies (simulated).';
                conditionText.className = 'text-green-400 text-xl font-bold';
            } else if (rating >= 3) {
                condition = 'Good Conditions';
                advice = 'A decent night for viewing, especially brighter objects.';
                conditionText.className = 'text-accent text-xl font-bold';
            } else if (rating >= 2) {
                condition = 'Fair Conditions';
                advice = 'There may be some light pollution or high humidity (simulated).';
                conditionText.className = 'text-yellow-400 text-xl font-bold';
            } else {
                condition = 'Poor Conditions';
                advice = 'It might be cloudy, too bright, or too early. Try again later.';
                conditionText.className = 'text-red-400 text-xl font-bold';
            }

            conditionText.textContent = condition;
            adviceText.textContent = advice;
        }


        /**
         * SIMULATED function to generate stargazing conditions based on location and time.
         * NOTE: This is a placeholder for a real API call.
         * @param {number} latitude - User's latitude.
         * @param {number} longitude - User's longitude.
         * @returns {number} A simulated stargazing rating from 1 to 5.
         */
        function getSimulatedConditions(latitude, longitude) {
            const now = new Date();
            const hour = now.getHours();

            // 1. Base Score based on Darkness (Primary Factor)
            let baseScore = 1; // Default poor (daytime)

            // Assume peak stargazing hours are 9 PM (21) to 4 AM (4)
            if (hour >= 21 || hour <= 4) {
                baseScore = 4; // Good starting score for night
            } else if (hour >= 18 && hour < 21 || hour >= 5 && hour < 8) {
                baseScore = 2; // Twilight/Dawn
            } else {
                baseScore = 1; // Daytime
            }

            // 2. Random Weather/Seeing Modifier (Simulating Cloud Cover/Atmosphere)
            // Generate a random integer between -1 and +1
            const weatherModifier = Math.floor(Math.random() * 3) - 1;

            let finalRating = baseScore + weatherModifier;

            // Ensure rating stays within 1 and 5
            finalRating = Math.max(1, Math.min(5, finalRating));

            console.log(`Simulated Base Score: ${baseScore}, Modifier: ${weatherModifier}, Final Rating: ${finalRating}`);
            return finalRating;
        }

        // --- Main Geolocation Logic ---

        /**
         * Clears previous results and shows the loading state.
         */
        function showLoading() {
            loader.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            resultsCard.classList.add('hidden');
            document.getElementById('status-card').classList.remove('hidden', 'bg-red-900');
            document.getElementById('status-card').classList.add('bg-secondary');
        }

        /**
         * Handles successful location retrieval.
         * @param {GeolocationPosition} position - The geolocation data.
         */
        function handleSuccess(position) {
            const lat = position.coords.latitude.toFixed(4);
            const lon = position.coords.longitude.toFixed(4);

            // Display location
            latDisplay.textContent = lat;
            lonDisplay.textContent = lon;

            // Calculate and display simulated conditions
            const rating = getSimulatedConditions(lat, lon);
            displayRating(rating);

            // Update UI state
            loader.classList.add('hidden');
            document.getElementById('status-card').classList.add('hidden'); // Hide the status card on success
            resultsCard.classList.remove('hidden');
        }

        /**
         * Handles errors during location retrieval.
         * @param {GeolocationPositionError} error - The geolocation error object.
         */
        function handleError(error) {
            loader.classList.add('hidden');
            resultsCard.classList.add('hidden');
            
            // Show the status card and style it red
            document.getElementById('status-card').classList.remove('hidden', 'bg-secondary');
            document.getElementById('status-card').classList.add('bg-red-900', 'p-4');

            let titleMsg = '';
            let detailsMsg = '';

            switch(error.code) {
                case error.PERMISSION_DENIED:
                    titleMsg = "Location Access Denied ðŸš« (Code 1)";
                    detailsMsg = "You blocked the request. Please check your browser's settings (the padlock icon in the address bar) and **Allow** location access for this site, then use the 'Recheck' button.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    titleMsg = "Position Unavailable ðŸ›°ï¸ (Code 2)";
                    detailsMsg = "Your device cannot determine its location (e.g., poor GPS signal, no Wi-Fi location service). Ensure your device's location services are enabled.";
                    break;
                case error.TIMEOUT:
                    titleMsg = "Location Timeout â³ (Code 3)";
                    detailsMsg = "The request to get your location took too long. This often happens with slow connections or weak GPS signal. Try moving to a spot with better reception.";
                    break;
                default:
                    titleMsg = "Unknown Geolocation Error âŒ";
                    detailsMsg = `An unknown error occurred: ${error.message || 'No message provided'}.`;
            }

            // Update error message display
            errorMessage.innerHTML = `<p class="text-xl font-bold">${titleMsg}</p><p class="text-sm mt-1">${detailsMsg}</p>`;
            errorMessage.classList.remove('hidden');

            console.error("Geolocation Error:", error);
        }

        /**
         * Initiates the location retrieval process.
         */
        function getLocation() {
            if (navigator.geolocation) {
                showLoading();
                navigator.geolocation.getCurrentPosition(handleSuccess, handleError, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                });
            } else {
                handleError({
                    code: -1,
                    message: "Geolocation is not supported by this browser."
                });
            }
        }

        // Run on page load
        window.onload = getLocation;

    </script>
</body>
</html>

